# Advanced Shell Scripting

---

# **1. How to use associative arrays in bash**

### **Scenario**

You are storing microservice names and their ports for a deployment script.

### **Explanation**

Associative arrays store key–value pairs.

```bash
declare -A app_ports
app_ports=(
  ["auth"]=8081
  ["orders"]=8082
  ["payment"]=8083
)

echo "Payment service runs on port: ${app_ports[payment]}"
```

### **Interview**

“I use associative arrays to map service names, file paths, or config values dynamically in large automation scripts.”

---

# **2. How to handle parallel execution using `&`**

### **Scenario**

Deploying 3 microservices at the same time to reduce downtime.

### **Example**

```bash
deploy_service auth &
deploy_service orders &
deploy_service payment &

wait
echo "All deployments finished!"
```

### **Interview**

“I use `&` to run tasks parallelly, especially when restarting multiple services or processing large logs.”

---

# **3. How do you use xargs with custom delimiters?**

### **Scenario**

File contains server names separated by commas.

```
server1,server2,server3
```

### **Example**

```bash
cat servers.txt | tr ',' '\n' | xargs -I{} -n1 bash -c 'ping -c1 {}'
```

### **Interview**

“I use xargs for bulk operations like deleting, pinging, copying across servers.”

---

# **4. How do you trap and handle multiple signals?**

### **Scenario**

Your script must clean temp files even if interrupted.

### **Example**

```bash
trap "cleanup" SIGINT SIGTERM EXIT

cleanup() {
  echo "Cleaning tmp files..."
  rm -rf /tmp/work
}
```

### **Interview**

“I trap EXIT + SIGINT + SIGTERM to handle safe shutdown in automation scripts.”

---

# **5. Write a bash script with a dynamic menu**

### **Scenario**

A menu for DevOps tasks: deploy, backup, restart.

```bash
while true; do
 echo "1. Deploy"
 echo "2. Restart"
 echo "3. Backup"
 echo "4. Exit"
 read -p "Choose: " choice

 case $choice in
   1) deploy ;;
   2) restart ;;
   3) backup ;;
   4) exit ;;
 esac
done
```

### **Interview**

“I use dynamic menus in internal tools for junior DevOps engineers.”

---

# **6. Explain process substitution in bash**

### **Scenario**

Compare two command outputs without creating temp files.

### **Example**

```bash
diff <(ls /var/log) <(ls /tmp)
```

### **Interview**

“Process substitution allows using command output like files — helpful in diff, sort, join operations.”

---

# **7. How to profile a slow shell script**

### **Scenario**

A provisioning script is taking too much time. You must find the slow step.

### **Example**

```bash
#!/bin/bash
set -x   # trace commands
PS4='+ $(date "+%s.%N")\011 '   # timestamp

# commands...
```

Or use `time`:

```bash
time ./script.sh
```

### **Interview**

“I use set -x + timestamps or time/strace to identify slow portions.”

---

# **8. How to create reusable bash libraries**

### **Scenario**

You want common functions used in 10 scripts, like logging and validation.

### **library file: lib.sh**

```bash
log() { echo "[$(date)] $1"; }
validate() { [[ -z "$1" ]] && echo "Missing value"; }
```

### **Use in main script**

```bash
source lib.sh
log "Deployment started"
```

### **Interview**

“This reduces duplication and improves maintainability in large DevOps scripting projects.”

---

# **9. How to perform JSON parsing in shell**

### **Scenario**

Read deployment status from API response.

### **Example — using jq**

```bash
status=$(jq -r '.status' status.json)
```

### **Interview**

“I always use jq for handling JSON from APIs, Kubernetes outputs, Docker inspect, etc.”

---

# **10. How to read a config file and use values**

### **Scenario**

Config file:

```
APP=orders
PORT=8082
```

### **Script**

```bash
source config.ini
echo "Deploying $APP on port $PORT"
```

### **Interview**

“I use config files to separate logic from configuration — a DevOps best practice.”

---

# **11. How to retry a failed command with a delay**

### **Scenario**

Retry DB connection 5 times before failing deployment.

```bash
for i in {1..5}; do
  mysql -u root -p123 -e "select 1" && break
  echo "Retry $i... waiting"
  sleep 5
done
```

### **Interview**

“I implement retries in all network-related scripts to avoid transient failures.”

---

# **12. How to implement exponential backoff**

### **Scenario**

Retry API call with increasing delay: 1s, 2s, 4s, 8s…

```bash
delay=1
for i in {1..5}; do
  curl -s http://api.com && break
  echo "Failed… retrying in $delay sec"
  sleep $delay
  delay=$((delay * 2))
done
```

### **Interview**

“This is used a lot in resilient DevOps systems, especially CI/CD and API calls.”

---

# **13. How to create a custom command-line tool with bash**

### **Scenario**

Your company needs a CLI tool `kkctl deploy auth`.

### **Script Example**

```bash
#!/bin/bash

case $1 in
 deploy)
    service=$2
    echo "Deploying $service"
 ;;
 *)
    echo "Usage: kkctl deploy <service>"
esac
```

### **Interview**

“I write internal CLI wrappers for deployments and automation tasks.”

---

# **14. Use of eval and its dangers**

### **Scenario**

Building dynamic variable names.

```bash
var="username"
eval echo \$$var
```

### **Danger**

Eval can execute arbitrary code → **security risk**.

### **Interview**

“I avoid eval unless absolutely required because it can execute malicious input.”

---

# **15. Difference between exec and subshell**

### **Scenario**

You want to redirect entire script output.

```bash
exec > logfile 2>&1
```

**exec replaces the shell process**
**(NO return to parent)**

### **Subshell**

```bash
( cd dir && ls )
```

Commands inside `()` run in child shell → changes don’t affect main shell.

### **Interview**

“I use subshells to isolate environment changes. I use exec for logging.”

---

# **16. How to manage background jobs and wait**

### **Scenario**

Processing 10 log files in parallel.

```bash
for f in logs/*.log; do
  process_file "$f" &
done

wait  # wait for all background jobs
echo "Processing done!"
```

### **Interview**

“I use wait to ensure parallel tasks complete before moving to next stage.”

---

# **17. How to ensure script idempotency**

### **Scenario**

Script that creates a directory should not fail if run twice.

### **Example**

```bash
[ ! -d /data/app ] && mkdir /data/app
```

### **Interview**

“My automation scripts are idempotent so that repeated runs don’t cause failures — same as Ansible behavior.”

---

# **18. How to prevent race conditions in parallel scripts**

### **Scenario**

Two parallel tasks writing to the same file → corrupt output.

### **Solution**

Use **flock** or lock files.

### **Example**

```bash
{
  flock -n 9 || exit 1
  echo "Writing safely" >> file.txt
} 9>file.lock
```

### **Interview**

“Race conditions happen in log writers & temp file creators; flock avoids this.”

---

# **19. How to create a lock file mechanism**

### **Scenario**

Ensure only one instance of backup script runs.

```bash
LOCK=/tmp/backup.lock

if [ -f "$LOCK" ]; then
  echo "Script already running."
  exit 1
fi

touch "$LOCK"
trap "rm -f $LOCK" EXIT
```

### **Interview**

“I use lock files to ensure safe parallel execution in cron jobs.”

---

# **20. How to create colorized output in terminal**

### **Scenario**

For CI pipelines:

* Green = Success
* Red = Failure
* Yellow = Warning

```bash
GREEN="\e[32m"
RED="\e[31m"
RESET="\e[0m"

echo -e "${GREEN}Deployment Successful${RESET}"
echo -e "${RED}Error Occurred${RESET}"
```

### **Interview**

“I use colored logs for readability, especially in interactive scripts.”
