# Advanced Shell Scripting 

*(Continuation from previous 1–20)*

---

# **21. How to encrypt and decrypt secrets in bash**

### **Scenario**

You need to store DB password securely in a file while deploying.

### **Using OpenSSL**

**Encrypt**

```bash
echo "MyDB@123" | openssl enc -aes-256-cbc -a -salt -pass pass:SecretKey > pass.enc
```

**Decrypt**

```bash
openssl enc -aes-256-cbc -d -a -pass pass:SecretKey < pass.enc
```

### **Interview**

“I use openssl to secure passwords in scripts. I avoid plain-text credentials and follow DevOps security principles.”

---

# **22. How to securely prompt for a password**

### **Scenario**

You want the user to enter root password without showing it on screen.

### **Example**

```bash
read -s -p "Enter DB Password: " dbpass
echo
```

### **Interview**

“I use `read -s` for silent input, especially for admin passwords, API keys, or tokens.”

---

# **23. How to log stdout and stderr separately**

### **Scenario**

CI pipeline:

* stdout → success.log
* stderr → error.log

### **Example**

```bash
command 1> success.log 2> error.log
```

### **Interview**

“This separation helps during debugging — stdout for normal flow, stderr for failures.”

---

# **24. How to perform multi-threaded processing**

### **Scenario**

You need to compress 100 log files faster using parallel threads.

### **Example**

```bash
ls *.log | xargs -n1 -P5 gzip
```

`-P5` → 5 threads run in parallel

### **Interview**

“I use xargs parallel processing for log rotation, file processing, and batch tasks.”

---

# **25. How to handle file locking in a bash script**

### **Scenario**

Two backup scripts must not write to the same archive simultaneously.

### **Using flock**

```bash
{
  flock -n 200 || exit 1
  tar -czf backup.tar.gz /data
} 200>/var/lock/backup.lock
```

### **Interview**

“File locking ensures safe read/write operations in parallel environments.”

---

# **26. How to monitor memory usage of a process**

### **Scenario**

Monitor Java heap usage and restart if memory crosses threshold.

```bash
pid=$(pgrep java)
mem=$(pmap $pid | tail -1 | awk '/[0-9]K/{print $2}')

echo "Memory: $mem"
```

### **Interview**

“I use pmap, ps, or /proc to monitor memory during troubleshooting.”

---

# **27. How to kill long-running processes via script**

### **Scenario**

A backup process should not run more than 1 hour.

### **Example**

```bash
pid=$(pgrep backup.sh)

if ps -p $pid -o etimes= | awk '{if($1 > 3600) exit 0; else exit 1}'; then
    kill -9 $pid
    echo "Long running process killed."
fi
```

### **Interview**

“I automate timeout checks in cron jobs and long-running scripts.”

---

# **28. How to write unit tests for bash scripts**

### **Scenario**

Testing a function that calculates sum.

### **Use bats (Bash Automated Testing System)**

Test file:

```bash
@test "sum function" {
  result=$(bash calc.sh sum 2 3)
  [ "$result" -eq 5 ]
}
```

### **Interview**

“I write tests with bats for critical automation scripts, improving reliability.”

---

# **29. How to generate a dynamic HTML report**

### **Scenario**

Create an HTML report of disk usage and serve it via Apache.

```bash
cat <<EOF > report.html
<html>
<body>
<h2>Disk Usage Report</h2>
<pre>
$(df -h)
</pre>
</body>
</html>
EOF
```

### **Interview**

“I generate HTML reports for CI summary, monitoring dashboards, or backup reports.”

---

# **30. How to create a cron job within a script**

### **Scenario**

Automatically schedule daily backup job.

### **Example**

```bash
(crontab -l ; echo "0 2 * * * /usr/local/bin/backup.sh") | crontab -
```

### **Interview**

“I modify crontab from automation scripts to set up system jobs programmatically.”

---

# **31. How to parse XML with bash**

### **Scenario**

Extract `<version>` from pom.xml in Jenkins pipeline.

### **Using xmllint**

```bash
version=$(xmllint --xpath "string(//project/version)" pom.xml)
```

### **Interview**

“I use xmllint or grep/awk with caution; XML parsing is essential in CI tasks.”

---

# **32. How to interact with REST API using curl**

### **Scenario**

Trigger a deployment from API.

### **Example**

```bash
curl -X POST -H "Content-Type: application/json" \
     -d '{"service":"auth"}' \
     http://deploy.api/run
```

### **Interview**

“I automate API integrations like Jenkins, GitHub, Jira, Nexus using curl + jq.”

---

# **33. How to integrate a script with systemd service**

### **Scenario**

Run a custom script as a systemd service.

### **Service File**

```
[Unit]
Description=KKFunda Auto Deployment Service

[Service]
ExecStart=/usr/local/bin/deploy.sh
Restart=always

[Install]
WantedBy=multi-user.target
```

### **Enable**

```bash
systemctl enable kkfunda.service
systemctl start kkfunda.service
```

### **Interview**

“I package bash automation tools as systemd services for production stability.”

---

# **34. How to read .env file and export variables**

### **Scenario**

.env:

```
DB_HOST=localhost
DB_USER=root
DB_PASS=Admin@123
```

### **Script**

```bash
export $(grep -v '^#' .env | xargs)
```

### **Interview**

“This pattern loads environment variables into the script cleanly.”

---

# **35. How to create a bash script to validate user input**

### **Scenario**

User must enter only numbers.

```bash
read -p "Enter age: " age
if [[ ! "$age" =~ ^[0-9]+$ ]]; then
  echo "Invalid — numbers only!"
  exit 1
fi
```

### **Interview**

“I validate inputs to avoid automation failures caused by wrong user entries.”

---

# **36. How to restrict execution to only one instance of the script**

### **Scenario**

Prevent two cron jobs from running the same script simultaneously.

### **Example**

```bash
if pidof -o %PPID -x "$0" >/dev/null; then
  echo "Script already running"
  exit 1
fi
```

### **Interview**

“This ensures safe and idempotent execution in production.”

---

# **37. How to use `select` for interactive menu creation**

### **Scenario**

Choose a Kubernetes namespace to deploy to.

```bash
PS3="Select Namespace: "
select ns in dev qa prod; do
  echo "You selected: $ns"
  break
done
```

### **Interview**

“select is very useful for interactive command-line utilities.”

---

# **38. Write a script to monitor SSH failures**

### **Scenario**

Monitor `/var/log/auth.log` for failed SSH attempts.

```bash
fails=$(grep "Failed password" /var/log/auth.log | wc -l)
echo "SSH failures today: $fails"
```

Or continuous monitoring:

```bash
tail -f /var/log/auth.log | grep --line-buffered "Failed password"
```

### **Interview**

“This helps with security monitoring and intrusion detection.”

---

# **39. Build a shell wrapper for Docker commands**

### **Scenario**

Team wants simpler docker commands, like:

```
kkdocker deploy auth
```

### **Script**

```bash
case $1 in
 deploy)
    docker build -t $2 .
    docker push $2
 ;;
 logs)
    docker logs -f $2
 ;;
esac
```

### **Interview**

“I create wrappers to simplify Docker operations for junior DevOps engineers.”

---

# **40. How to display progress bars in bash**

### **Scenario**

Show progress during file upload or backup.

### **Example**

```bash
for i in {1..100}; do
  echo -ne "Progress: $i%\r"
  sleep 0.1
done
echo
```

### **Advanced Example (copy progress)**

```bash
pv file.iso > /backup/file.iso
```

### **Interview**

“I use progress bars for long-running tasks like file transfers or backups.”

---

