#  Scenario-Based Shell Scripting 

---

# **1. Script to monitor disk usage and alert when over 80%**

### **Scenario**

In production, your root filesystem `/` is filling up due to logs. You want an automatic alert when usage > 80%.

### **Script**

```bash
#!/bin/bash

threshold=80
usage=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')

if [ "$usage" -gt "$threshold" ]; then
    echo "ALERT: Disk usage at ${usage}% on $(hostname)" | mail -s "Disk Alert" admin@example.com
fi
```

### **Interview Explanation**

“I run this script as a cron job. It prevents outages due to disk full issues — which is one of the most common production incidents.”

---

# **2. Script to clean /tmp directory older than 7 days**

### **Scenario**

Servers accumulate temp files and reduce available disk space. Need automated cleanup.

### **Script**

```bash
#!/bin/bash
find /tmp -type f -mtime +7 -exec rm -f {} \;
```

### **Interview**

“I use find with mtime to remove stale files and prevent disk pressure — important for legacy and app servers.”

---

# **3. Script to monitor a web service and alert on failure**

### **Scenario**

Your frontend URL must be checked every minute to ensure uptime.

### **Script**

```bash
#!/bin/bash

URL="https://myapp.com"
status=$(curl -o /dev/null -s -w "%{http_code}" $URL)

if [ "$status" -ne 200 ]; then
    echo "ALERT: $URL is down. Status: $status" | mail -s "Service Down" admin@example.com
fi
```

### **Interview**

“This is similar to uptime monitoring. I check HTTP status codes and alert immediately.”

---

# **4. Rotate logs and keep last 5 files**

### **Scenario**

Application generates `app.log` which grows to GBs. Need rotation.

### **Script**

```bash
#!/bin/bash

log="/var/log/app.log"

for i in {5..1}; do
    if [ -f "$log.$i" ]; then
        mv "$log.$i" "$log.$((i+1))"
    fi
done

mv "$log" "$log.1"
touch "$log"
```

### **Interview**

“I created custom log rotation where built-in logrotate wasn’t available.”

---

# **5. Backup MySQL DB daily with timestamp**

### **Scenario**

Daily DB backups are required for compliance and disaster recovery.

### **Script**

```bash
#!/bin/bash

TIMESTAMP=$(date +%F-%H-%M)
mysqldump -u root -p'RootPass' mydb > /backup/mydb-$TIMESTAMP.sql
```

### **Interview**

“I automate nightly DB backups with timestamp to avoid overwriting and enable easy restores.”

---

# **6. Validate IP addresses in a text file**

### **Scenario**

You receive a file containing IPs from multiple teams, need to validate them.

### **Script**

```bash
#!/bin/bash

while read ip; do
    if [[ $ip =~ ^([0-9]{1,3}\.){3}[0-9]{1,3}$ ]]; then
        echo "$ip is valid"
    else
        echo "$ip is INVALID"
    fi
done < ips.txt
```

### **Interview**

“I use regex to verify the format before using IPs in automation.”

---

# **7. Read server IPs from a file and ping each**

### **Scenario**

Your team needs to verify connectivity to 50 servers.

### **Script**

```bash
#!/bin/bash

while read server; do
    if ping -c1 $server &>/dev/null; then
        echo "$server - UP"
    else
        echo "$server - DOWN"
    fi
done < servers.txt
```

### **Interview**

“I automate health checks of servers by reading values from files.”

---

# **8. Fetch and email top CPU-consuming processes**

### **Scenario**

You want an hourly report of CPU top usage.

### **Script**

```bash
#!/bin/bash

ps -eo pid,ppid,cmd,%cpu --sort=-%cpu | head > /tmp/topcpu.txt
mail -s "Top CPU Processes" admin@example.com < /tmp/topcpu.txt
```

### **Interview**

“I collect performance metrics automatically and send reports to the team.”

---

# **9. SSH into multiple servers and execute commands**

### **Scenario**

Need to restart nginx on 20 servers.

### **Script**

```bash
#!/bin/bash

while read server; do
    ssh -o StrictHostKeyChecking=no $server "sudo systemctl restart nginx"
done < servers.txt
```

### **Interview**

“I use a loop + SSH to automate bulk operations. Sometimes I integrate parallel SSH for speed.”

---

# **10. Script to archive application logs to S3**

### **Scenario**

Logs must be moved to S3 to reduce disk usage.

### **Script**

```bash
#!/bin/bash

timestamp=$(date +%F)
tar -czf app-$timestamp.tar.gz /var/log/myapp/

aws s3 cp app-$timestamp.tar.gz s3://mybucket/logs/
```

### **Interview**

“This is common in log archival workflows — compress locally → push to S3.”

---

# **11. Script to restart a service if down**

### **Scenario**

Ensure nginx is always running.

### **Script**

```bash
#!/bin/bash

if ! systemctl is-active --quiet nginx; then
    echo "nginx is down - restarting"
    systemctl restart nginx
fi
```

### **Interview**

“I use systemctl checks and auto-restart logic — similar to self-healing.”

---

# **12. Script to tail multiple logs in parallel**

### **Scenario**

Your application has multiple logs: access.log, error.log, app.log.

### **Script**

```bash
#!/bin/bash

tail -f /var/log/nginx/access.log \
       /var/log/nginx/error.log \
       /var/log/app.log
```

### **Advanced parallel tail (each with header):**

```bash
multitail /var/log/app.log /var/log/nginx/access.log /var/log/nginx/error.log
```

### **Interview**

“Parallel log watching helps me troubleshoot issues in real time across services.”

